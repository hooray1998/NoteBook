# 设备组绑定信息保存

当未上线时不可以开始调试。
Group::login
肯定id在group中，只需要 指针参数 
Group::logout
肯定在group中，只需要指针参数。

# 最新的设计方案

测试todouble 和 from latin & to_latin
就用string类型，不用double

Group

>一个enum M
>三个模式，三组向量。
>几列对应几个向量，类型不同，

length记录长度
curMode记录当前的模式(取值0,1,2,3,0代表没动静)
curAction记录当前是在请求还是在发送,根据这两个值可以确定当前的状态
lastRequest = M::a, 记录上一次是否还有未收到的数据，如果有，下次收到的时候丢弃，并将值至空
save记录最新的变化有没有保存。

有新数据增加就发个信号，让主线程刷新界面。
收到数据解析：
1. 上次中止时还没收到的，=》 丢弃,至空
2. 此次请求的，=》存储处理，刷新表格。结束后继续下一个动作
	1. 继续请求 => send to A/B
	2. 返回最终值 => send to A
	3. 得出结论 => showLog
	4. 如果是新的一列，则更新length并且添加工作人员
	5. 更新时间，每次都更新
3. 存储处理指:
	

只有状态列可编辑,默认每次都保存空值，其他均不可编辑。当编辑时保存其值到向量中，如果越界了就不保存，并且提示。

当cell发生变化时，scrolltoitem


清除功能
1. 绑定关系
2. 表格
3. 日志

退出时隐藏主界面，保存所有信息。


## 在哪里处理解析消息

收到b
group处理
去掉showLog
处理好后group发送newLog，这时再showlog，必要时刷新界面。
也就是有group的时候，log都是由group发送，没有group，线程发送。 其他绑定解绑消息主线程发送。

## 如果请求中止，则会
自动补全未收到的值
请求的下一个值自动丢弃，没请求就算了。


### 数据显示规则

若状态列含有warning：则标红。保存的时候也是。


### 数学公式计算规则

公式单独存。
一个公式就是一个字符串。
主类中管理公式的添加和删除。
每个组的每个模式存储当前使用的公式。

项目设计

协议

设备id(6)
数据类型(2)
内容

类型号|说明
:-:|:-
00|异常
01|设备登录
02|发送α
03|发送β和γ



疑问
- 在软件方案中没有看到数学公式的用途

- 能否将查看各设备组的下拉菜单换成左侧列表,1:便于操作;2:下拉菜单可能不能显示50个，选择太复杂。
- 根据表格我似乎看到每次发送的数据只包含几个数值,因为表格中每行的数据不就是三个周期结束后收到的数据么，之前说的几百KB是指的什么。
- 是否在收到来自设备A或设备B数据后回复确认收到报文，这对上位机和设备机器开发都有影响
- 数据β和γ是否在一条报文中一起发送,还是分两次连续发送
- 设备机软件要求
	- 如果要求突然掉线后能恢复，在第一次登录时需要填写设备号，以后登录自动绑定,防止掉线后重新登录失去绑定

文件命名规则
Group设备组id(三位数)_01.txt(a)//A的数据
Group设备组id(三位数)_02.txt(b,c)//B的数据
Group设备组id(三位数)_03.txt(a)//数学公式
Group设备组id(三位数)_04.txt(a)//计算结果
Group设备组id(三位数)_05.xls(a)//模式1表格
Group设备组id(三位数)_06.xls(a)//模式2表格

Class
widget
	*curGroup
	getGroupList()
	showGroupList()//显示A，B的状态,下线后能恢复
	addGroup(a_id, b_id)
	removeGroup()//remove  files
	allpthread对应每个设备{
		*group
		read()
		write()
		signal:Information(显示动态消息)
	}
	Expression{
		QString allExpression[]
		analyExpression()
		addExpression()
		saveExpression()//存储到文件
		chooseExpression()
	}
	*allgroup{//顺序存储，存储指针，删除的话len--，循环前移
		groupinfo{
			curStatus;//0未绑定;1初始状态；2收到A了；3向B发了请求；4收到B了；5让A继续工作；6将结果返回A
			id
			name
			loginTime
			allTime
		}
		*pthreadA
		*pthreadB
		alldata(class){
			saveAlpha()//读取保存
			saveBeta()
			analyAlpha()//根据协议解析
			analyBeta()
			calData()//使用公式
			showData1()//模式一或二
			showData2()//模式
			saveData_to_Excel()
			int curExpression
		}
	}




@ 项目安排 
	☐ 项目精简
		☐ 服务器断开连接
		☐ tcp文件发送
		☐ 文件1MB,测试丢包性
	☐ 传输协议制定模块		
	☐ 识别与绑定模块
		☐ 设备A设备B识别	
		 ☐ 设备组列表	
		 ☐ 绑定设备与解绑设备	
	☐ 数据传输模块
		☐ 解析设备A的数据	
		☐ 请求B与回应A	
		☐ 解析设备B的数据	
	☐ 数学公式处理模块
		☐ 公式界面显示、编辑	
		☐ 公式的解析	
		☐ 公式存储和使用	
	☐ 数据处理模块
		☐ 表格模型设计
			☐ 两种模式的表格模型
		☐ 解析数据的显示
			☐ 将解析后的数据显示出来
		☐ 数据计算
			☐ 按照模式一的规则
			☐ 按照模式二的规则
		☐ 数据显示
			☐ 将计算结果实时显示
		☐ 数据回传
			☐ 将结果回传给对应的设备A
	☐ 多个设备组的数据管理
		☐ 设备组切换查看功能	
	☐ Excel导出
		☐ 数据存储为表格	
	☐ 总体测试
		☐ 设备组软件简单模拟开发	
		☐ 测试所有功能	




